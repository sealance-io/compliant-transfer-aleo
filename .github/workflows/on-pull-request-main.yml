name: Aleo Program Tests

# Define the common paths that should trigger all tests
env:
  CORE_PATHS: "package.json,package-lock.json,aleo-config.js"

on:
  workflow_dispatch:
  pull_request:
    branches:
      - main
    paths-ignore:
      - '**/*.md'

concurrency:
  group: ci-tests-${{ github.ref }}-1
  cancel-in-progress: true

jobs:
  merkle-tree-test:
    uses: ./.github/workflows/reusable-aleo-test.yml
    with:
      job_name: "Merkle Tree Test"
      test_command: "npm run test:select ./test/merkle_tree.test.ts"
      watched_paths: "programs/rediwsozfo_v2.leo,${{ env.CORE_PATHS }}"
    secrets: inherit

  compliant-transfer-test:
    uses: ./.github/workflows/reusable-aleo-test.yml
    with:
      job_name: "Compliant Transfer Test"
      test_command: "npm run test:select ./test/compliant_transfer_v0.test.ts"
      watched_paths: "programs/tqxftxoicd_v2.leo,${{ env.CORE_PATHS }}"
    secrets: inherit

  freeze-registry-test:
    uses: ./.github/workflows/reusable-aleo-test.yml
    with:
      job_name: "Freeze Registry Test"
      test_command: "npm run test:select ./test/freeze_registry.test.ts"
      watched_paths: "programs/freeze_registry.leo,${{ env.CORE_PATHS }}"
    secrets: inherit

  timelock-policy-test:
    uses: ./.github/workflows/reusable-aleo-test.yml
    with:
      job_name: "Timelock Policy Test"
      test_command: "npm run test:select ./test/timelock.test.ts"
      watched_paths: "programs/compliant_timelock_transfer.leo,${{ env.CORE_PATHS }}"
    secrets: inherit

  threshold-policy-test:
    uses: ./.github/workflows/reusable-aleo-test.yml
    with:
      job_name: "Threshold Policy Test"
      test_command: "npm run test:select ./test/compliant_threshold_transfer.test.ts"
      watched_paths: "programs/compliant_threshold_transfer.leo,${{ env.CORE_PATHS }}"
    secrets: inherit